# TODO - 太陽光発電・蓄電池キャッシュフロー分析システム

## 完了した機能
- ✅ 基本的なシステム構築
- ✅ 入力フォームの実装（太陽光パネル容量、蓄電池容量、電力使用量など）
- ✅ 売電設定の切り替え機能
- ✅ 50年間のキャッシュフロー計算ロジック
- ✅ NPV、IRR計算機能
- ✅ Chart.jsによるグラフ表示
- ✅ 詳細キャッシュフロー表の表示
- ✅ レスポンシブデザイン対応
- ✅ WCAG 2.2準拠の基本的なアクセシビリティ
- ✅ **ダークモード/ライトモード切り替え機能**
- ✅ **WCAG 2.2準拠のモダンUIデザイン**
  - グラスモーフィズムエフェクト
  - モダンなグラデーションデザイン
  - 高コントラスト対応
  - フォーカス表示の明確化（ring-2）
  - タッチターゲットサイズ確保（44×44px以上）
  - ARIAラベルの適切な設定
  - キーボードナビゲーション対応
  - スクリーンリーダー対応
- ✅ **インタラクティブなUI/UX**
  - スムーズなアニメーション（fadeIn、slideIn）
  - ローディング状態の表示
  - ホバーエフェクト
  - 視覚的フィードバック
- ✅ **データビジュアライゼーションの改善**
  - グラフの見やすさ向上
  - 統計情報の追加表示
  - ソート可能なテーブル
  - 総合評価の表示
- ✅ **Tailwind CSS v4対応**
  - 設定ファイル不要の新形式に移行
  - postcss.config.mjsの修正
  - globals.cssをv4形式に完全移行
- ✅ **年間電力使用量の自動計算**
  - 一般家庭の平均4,500kWh/年を基準
  - パネル容量に応じて調整（10kW超で20%/10kW増加）
- ✅ **計算ロジックの改善**
  - 自家消費優先率の解釈を修正（発電量に対する割合）
  - 推定年間発電量の表示追加（1,000kWh/kW/年）
  - デフォルト値の最適化（太陽光12kW、蓄電池20kWh、自家消費優先率80%）
- ✅ **IRR計算の改善**
  - Infinity問題の修正（上限999.9%設定）
  - エラーハンドリングの追加
  - 極端な値の表示改善（「即時回収」「計算不可」など）
  - 初期投資額が0以下の場合の処理
- ✅ **初期投資額の手動設定機能**
  - 100万円〜2000万円の範囲で選択可能
  - 手動設定時は発電量を推定計算
  - 自動計算と手動設定の切り替え機能
- ✅ **UI/UX改善の実装（印刷対応を除く）**
  - ツールチップの充実（各入力項目・計算ロジックの説明）
  - グラフの拡張（年間収支内訳・エネルギーフロー推移）
  - コード整理（utils/units.ts作成・計算関数のリファクタリング）

## 今後の改善案・追加機能

### 機能拡張
1. **PDFエクスポート機能**
   - シミュレーション結果をPDFでダウンロード可能にする
   - jsPDFやhtml2canvasなどのライブラリを使用

2. **シナリオ比較機能**
   - 複数のパラメータセットを保存・比較できる機能
   - 比較グラフの表示

3. **データの永続化**
   - LocalStorageを使用した入力値・結果の保存
   - 過去のシミュレーション履歴の表示

4. **詳細設定の追加**
   - 出力制御の考慮
   - 地域別の日射量データの反映
   - 季節変動の考慮

### UI/UX改善
1. ✅ **ツールチップの充実**
   - ✅ 各入力項目の詳細説明ツールチップ
   - ✅ 計算ロジックの説明

2. ✅ **グラフの拡張**
   - ✅ 年間収支の内訳グラフ
   - ✅ 売電量・自家消費量の推移グラフ

3. **印刷対応**
   - 印刷用のスタイルシート追加
   - 印刷プレビュー機能
   - グラフやテーブルの印刷最適化

4. ✅ **コードの整理・リファクタリング**
   - ✅ 単位管理の一元化（utils/units.ts の作成）
   - ✅ 計算ロジックの関数化（calculateManualInitialCost等）

### パフォーマンス最適化
1. **計算処理の最適化**
   - Web Workersを使用した並列計算
   - メモ化による再計算の削減

2. **バンドルサイズの削減**
   - Chart.jsの動的インポート
   - 不要な依存関係の削除

3. **コードの一貫性改善**
   - グラフコンポーネントでutils/units.tsの関数を活用
   - グラフのカラーパレットを定数として外部化
   - 共通のChart.js設定をユーティリティ化
   - エラーバウンダリの追加

### アクセシビリティ強化
1. **カラーコントラストの確認**
   - WCAG AAA基準への準拠

2. **多言語対応**
   - 英語版の追加
   - i18n対応

### テスト・品質管理
1. **単体テスト**
   - 計算ロジックのユニットテスト追加（Jest）
   - コンポーネントテスト（React Testing Library）
   - **太陽光パネル交換前後の発電量計算のテスト追加**
   - **手動費用設定時の初期投資額計算テスト**
   - **各費用パラメータの境界値テスト**
   - **UIの表示値の正確性テスト**

2. **E2Eテスト**
   - Cypress/Playwrightによる統合テスト

3. **型安全性の強化**
   - より厳密な型定義
   - zodによるランタイム検証
   - **calculateAnnualGeneration関数のJSDocコメント追加（yearsSinceLastReplacementパラメータの説明）**

### ドキュメント
1. **ユーザーガイド**
   - 使い方マニュアルの作成
   - FAQ section

2. **開発者向けドキュメント**
   - 計算ロジックの詳細説明
   - APIドキュメント

### セキュリティ
1. **入力値検証の強化**
   - XSS対策
   - 不正な入力値のハンドリング

2. **CSPヘッダーの設定**
   - Content Security Policyの適切な設定

## 注意事項
- 現在の実装は参考値としての利用を前提としており、実際の投資判断には専門家への相談を推奨
- 電気料金や売電価格は地域・契約内容により異なるため、実際の値での検証が必要
- 技術進歩による価格低下は簡易的なモデルで実装されており、より精緻なモデルへの改善余地あり 